name: Welcome Bot

on:
  issues:
    types: [opened]
  pull_request:
    types: [opened]
  pull_request_review:
    types: [submitted]

jobs:
  welcome-new-contributor:
    if: github.event_name == 'issues' || github.event_name == 'pull_request'
    runs-on: ubuntu-latest
    
    steps:
    - name: Check if first contribution
      uses: actions/github-script@v8
      id: check-contributor
      with:
        script: |
          const { owner, repo } = context.repo;
          const author = context.payload.sender.login;
          
          // Check if this is the user's first contribution
          const issues = await github.rest.search.issuesAndPullRequests({
            q: `repo:${owner}/${repo} author:${author} is:closed`
          });
          
          const isFirstContribution = issues.data.total_count === 0;
          console.log(`First contribution for ${author}: ${isFirstContribution}`);
          
          return isFirstContribution;
          
    - name: Welcome new issue contributor
      if: github.event_name == 'issues' && steps.check-contributor.outputs.result == 'true'
      uses: actions/github-script@v8
      with:
        script: |
          const welcomeMessage = `## ğŸ‘‹ Welcome to HQ Rental SDK!
          
          Thank you for opening your first issue! We're excited to have you as part of our community.
          
          ### What happens next?
          - ğŸ·ï¸ Your issue will be automatically labeled and triaged
          - ğŸ‘€ A maintainer will review it within 24-48 hours
          - ğŸ’¬ Feel free to provide any additional context or ask questions
          
          ### New to the project?
          - ğŸ“š Check out our [Contributing Guide](https://github.com/mr-cto/hq-rental-sdk/blob/main/.github/CONTRIBUTING.md)
          - ğŸ¯ Look for issues labeled \`good first issue\` if you'd like to contribute code
          - ğŸ’¡ Join our discussions for questions and ideas
          
          ### Quality Standards
          This project maintains **100% test coverage** and high quality standards. All contributions are welcome, and we'll help guide you through our development process!
          
          Thanks again for your interest in improving the HQ Rental SDK! ğŸš€`;
          
          await github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: welcomeMessage
          });
          
    - name: Welcome new PR contributor
      if: github.event_name == 'pull_request' && steps.check-contributor.outputs.result == 'true'
      uses: actions/github-script@v8
      with:
        script: |
          const welcomeMessage = `## ğŸ‰ Welcome to your first contribution!
          
          Thank you for opening your first pull request! This is awesome! ğŸš€
          
          ### Automated Checks
          Your PR will automatically run through our quality checks:
          - âœ… **Tests**: All tests must pass
          - ğŸ“Š **Coverage**: 100% test coverage must be maintained  
          - ğŸ¨ **Linting**: Code style and formatting checks
          - ğŸ”§ **Build**: TypeScript compilation verification
          - ğŸ·ï¸ **Labeling**: Automatic categorization based on changes
          
          ### Review Process
          - ğŸ‘€ A maintainer will review your PR within 24-48 hours
          - ğŸ’¬ We may ask questions or suggest improvements
          - ğŸ¤ We're here to help guide you through the process!
          
          ### Need Help?
          - ğŸ“š Check our [Contributing Guide](https://github.com/mr-cto/hq-rental-sdk/blob/main/.github/CONTRIBUTING.md)
          - ğŸ’¡ Ask questions in the PR comments
          - ğŸ” Look at our \`llms.txt\` file for architectural patterns
          
          Thanks for contributing to the HQ Rental SDK! We can't wait to see what you've built! ğŸ™Œ`;
          
          await github.rest.issues.createComment({
            issue_number: context.payload.pull_request.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: welcomeMessage
          });

  thank-reviewer:
    if: github.event_name == 'pull_request_review' && github.event.review.state == 'approved'
    runs-on: ubuntu-latest
    
    steps:
    - name: Thank reviewer
      uses: actions/github-script@v8
      with:
        script: |
          const reviewer = context.payload.review.user.login;
          const prAuthor = context.payload.pull_request.user.login;
          
          // Don't thank self-approvals
          if (reviewer === prAuthor) return;
          
          const thankYouMessage = `Thank you @${reviewer} for the review! ğŸ™ Your feedback helps maintain our code quality standards.`;
          
          await github.rest.issues.createComment({
            issue_number: context.payload.pull_request.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: thankYouMessage
          });

  celebrate-merge:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == true
    
    steps:
    - name: Celebrate successful merge
      uses: actions/github-script@v8
      with:
        script: |
          const author = context.payload.pull_request.user.login;
          const prNumber = context.payload.pull_request.number;
          const prTitle = context.payload.pull_request.title;
          
          const celebrationMessage = `## ğŸ‰ Contribution Merged!
          
          Congratulations @${author}! Your PR #${prNumber} "${prTitle}" has been successfully merged!
          
          ### Impact
          Your contribution helps make the HQ Rental SDK better for everyone! ğŸš€
          
          ### What's Next?
          - ğŸ·ï¸ This will be included in the next release
          - ğŸ“ Check out other issues to contribute more
          - ğŸŒŸ Consider starring the repository if you haven't already
          
          Thank you for being part of our community! ğŸ™Œ`;
          
          await github.rest.issues.createComment({
            issue_number: prNumber,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: celebrationMessage
          });